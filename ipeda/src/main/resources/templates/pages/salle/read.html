<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">
<head>
<title>Salles</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<script type="text/javascript" th:src="@{/assets/js/metier/salle.js}"></script>
</head>
<body>

	<div layout:fragment="content">

		<script th:inline="javascript">
			/*<![CDATA[*/
				
			var storedMessage = ""; 

			$(document).ready(function() {
				$('#example').DataTable({
					"dom": '<"toolbar">frtip',
					"processing": true,
					"serverSide" : true,
					"ordering": true,
					"order" : [ [ 1, "asc" ] ], /* mettre des espaces pour Ã©viter collision avec Thymeleaf */
					"pageLength": 10,
					"searchDelay": 0,
					"ajax": {
		                "url": "/rest/salles"
		            },
					"columns": [
			            {	data: "id",
			            	searchable: false,
			            	width: "30px"
			            },
			            {	data: "libelle" },
						{
				            className:      "colonne-modifier dt-center",
				            orderable:      false,
				            searchable:     false,
				            data:           null,
				            width: '100px',
				            render: function ( data, type, row ) {
				                return "<a href=\"#\" onclick=\"javascript:openSalleModalUpdate('salleUpdate', " + data.id + ");\"><span class=\"fas fa-edit btn btn-primary\"></span></a>";
				            }
				        },
						{
				            className:      "colonne-supprimer dt-center",
				            orderable:      false,
				            searchable:     false,
				            data:           null,
				            width: '100px',
				            render: function ( data, type, row ) {
				                return "<a href=\"#\" onclick=\"javascript:openSalleModalDelete('salleDelete', " + data.id + ");\"><span class=\"fas fa-trash-alt btn btn-danger\"></span></a>";
				            }
				        }
			        ]
				});
				$("div.toolbar").html('<a href="#" onclick="javascript:openSalleModalCreate(\'salleCreate\');" class="btn btn-outline-success"><span class="fas fa-plus-square"></span> ' + [[#{msg.0000}]] + '</a>');
				
				$('#modal-form-salleCreate, #modal-form-salleUpdate').submit(function(e) {
					var diz = $(this);
				    $.ajax({
						type: "POST",
						url: diz.attr('action'),
						data: diz.serialize(),
						success: function(response) {
							if(response.status == 'ERROR') {
								$.each(response.listError, function(k, v) {
									diz.parent().find("#" + v.field).next().remove();
									diz.parent().find("#" + v.field).after("<small>" + v.defaultMessage + "</small>");
								});
							} else {
								window.location.replace(response.returnUrl);
							}
						}
					});
				    e.preventDefault();
				});
				
			
				var storedMessage = $("#modal-container-salleDelete #message").html();
				
				$('#modal-container-salleDelete').on('hidden.bs.modal', function (e) {
					$(this).find("#message").html(storedMessage);
				});
				
				$('#modal-form-salleDelete').submit(function(e) {
					var diz = $(this);
				    $.ajax({
						type: "POST",
						url: diz.attr('action'),
						data: diz.serialize(),
						success: function(response) {
							if(response.status == 'ERROR') {
								$.each(response.listError, function(k, v) {
									diz.parent().find("#message").html(v.defaultMessage);
								});
							} else {
								window.location.replace(response.returnUrl);
							}
						}
					});
				    e.preventDefault();
				});

			});

			/*]]>*/
		</script>

		<table id="example" class="table table-striped table-bordered hover" style="width: 100%">
			<thead>
				<tr>
					<th>[[#{msg.0006}]]</th>
					<th>[[#{msg.0003}]]</th>
					<th>[[#{msg.0007}]]</th>
					<th>[[#{msg.0008}]]</th>
				</tr>
			</thead>
			<tfoot>
				<tr>
					<th>[[#{msg.0006}]]</th>
					<th>[[#{msg.0003}]]</th>
					<th>[[#{msg.0007}]]</th>
					<th>[[#{msg.0008}]]</th>
				</tr>
			</tfoot>
		</table>

		<div layout:insert="fragments/modal :: modal(modalId='salleCreate', modalHeader='msg.0000', modalButton='cancel|msg.0001,submit|msg.0002')" th:remove="tag">
			<form id="modal-form-salleCreate" layout:fragment="modal-content" action="#" th:action="@{/rest/salles/save}" th:object="${salle}" method="post">
				<div class="form-group">
					<label for="libelle" th:text="#{msg.0003}"></label> 
					<input type="hidden" th:field="*{id}" />
					<input type="text" class="form-control" th:field="*{libelle}" th:placeholder="#{msg.0004}" />
					<small th:if="${#fields.hasErrors('libelle')}" th:errors="*{libelle}">Name Error</small>
				</div>
			</form>
		</div>
		
		<div layout:insert="fragments/modal :: modal(modalId='salleUpdate', modalHeader='msg.0010', modalButton='cancel|msg.0001,submit|msg.0007')" th:remove="tag">
			<form id="modal-form-salleUpdate" layout:fragment="modal-content" action="#" th:action="@{/rest/salles/save}" th:object="${salle}" method="post">
				<div class="form-group">
					<label for="libelle" th:text="#{msg.0003}"></label> 
					<input type="hidden" th:field="*{id}" />
					<input type="text" class="form-control" th:field="*{libelle}" th:placeholder="#{msg.0004}" />
					<small th:if="${#fields.hasErrors('libelle')}" th:errors="*{libelle}">Name Error</small>
				</div>
			</form>
		</div>
		
		<div layout:insert="fragments/modal :: modal(modalId='salleDelete', modalHeader='msg.0009', modalButton='cancel|msg.0001,submitDanger|msg.0008')" th:remove="tag">
			<form id="modal-form-salleDelete" layout:fragment="modal-content" action="#" th:action="@{/rest/salles/delete}" th:object="${salle}" method="post">
				<input type="hidden" th:field="*{id}" />
				<input type="hidden" th:field="*{libelle}" />
				<p id="message" class="text-center" th:utext="#{msg.0011}"></p>
			</form>
		</div>

	</div>

</body>
</html>